/*
Write a sql to output below columns
employeeid,employee_default_phone_number,totalentry,totallogin,totallogout,latestlogin,latestlogout
*/

CREATE TABLE IF NOT EXISTS LOGIN_DATA
(
    EMPLOYEEID	INT,
    ENTRY_DETAILS	VARCHAR(512),
    TIMESTAMP_DETAILS	DATETIME
);

INSERT INTO LOGIN_DATA (EMPLOYEEID, ENTRY_DETAILS, TIMESTAMP_DETAILS) VALUES
	('1000', 'LOGIN', '2023-06-16 01:00:15.34'),
	('1000', 'LOGIN', '2023-06-16 02:00:15.34'),
	('1000', 'LOGIN', '2023-06-16 03:00:15.34'),
	('1000', 'LOGOUT', '2023-06-16 12:00:15.34'),
	('1001', 'LOGIN', '2023-06-16 01:00:15.34'),
	('1001', 'LOGIN', '2023-06-16 02:00:15.34'),
	('1001', 'LOGIN', '2023-06-16 03:00:15.34'),
	('1001', 'LOGOUT', '2023-06-16 12:00:15.34');

CREATE TABLE IF NOT EXISTS EMP_DATA
(
    EMPLOYEEID	INT,
    PHONE_NUMBER	INT,
    ISDEFAULT	VARCHAR(512)
);

INSERT INTO EMP_DATA (EMPLOYEEID, PHONE_NUMBER, ISDEFAULT) VALUES
	('1001', '9999', 'FALSE'),
	('1001', '1111', 'FALSE'),
	('1001', '2222', 'TRUE'),
	('1003', '3333', 'FALSE');

SELECT LD.EMPLOYEEID,
    SUM(CASE WHEN ENTRY_DETAILS = 'LOGIN' THEN 1 ELSE 0 END) AS TOTAL_LOGIN,
    SUM (CASE WHEN ENTRY_DETAILS = 'LOGOUT' THEN 1 ELSE 0 END) AS TOTAL_LOGOUT,
    COUNT(ENTRY_DETAILS) AS TOTAL_ENTRY,
    MAX (CASE WHEN ENTRY_DETAILS = 'LOGIN' THEN TIMESTAMP_DETAILS ELSE NULL END ) AS LATEST_LOGIN,
    MAX (CASE WHEN ENTRY_DETAILS = 'LOGOUT' THEN TIMESTAMP_DETAILS ELSE NULL END) AS LATEST_LOGOUT,
    MAX(CASE WHEN ISDEFAULT = 'TRUE' THEN PHONE_NUMBER ELSE NULL END) AS EMPLOYEE_DEFAULT_PHONE_NUMBER
FROM   LOGIN_DATA LD
       LEFT OUTER JOIN EMP_DATA ED
                    ON LD.EMPLOYEEID = ED.EMPLOYEEID
                       AND ED.ISDEFAULT = 'TRUE'
GROUP  BY LD.EMPLOYEEID